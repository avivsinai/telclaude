# ═══════════════════════════════════════════════════════════════════════════════
# Telclaude Docker Environment Variables
#
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#
# CREDENTIAL MANAGEMENT:
#   Most credentials now live in the vault sidecar.
#   After first startup, import existing credentials:
#     docker exec -it telclaude telclaude vault import-secrets
#     docker exec -it telclaude telclaude vault import-anthropic
#
#   Or add credentials directly:
#     docker exec -it telclaude telclaude vault add secret telegram-bot-token
#     docker exec -it telclaude telclaude vault add http api.anthropic.com --type api-key --header x-api-key
#
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# Required
# ─────────────────────────────────────────────────────────────────────────────────

# Path to your projects folder (where Claude will work)
WORKSPACE_PATH=/mnt/c/Users/YourName/Projects

# TOTP encryption key for 2FA secrets
# Generate with: openssl rand -base64 32
# IMPORTANT: Keep this safe! If lost, all 2FA secrets become unrecoverable.
TOTP_ENCRYPTION_KEY=GENERATE_WITH_openssl_rand_-base64_32

# Vault encryption key for credential storage
# Generate with: openssl rand -base64 32
# IMPORTANT: Keep this safe! If lost, all stored credentials become unrecoverable.
VAULT_ENCRYPTION_KEY=GENERATE_WITH_openssl_rand_-base64_32

# ─────────────────────────────────────────────────────────────────────────────────
# Credentials (env var fallbacks — vault preferred)
#
# These are optional when vault is configured. The relay checks:
#   1. Vault (highest priority)
#   2. Config file
#   3. Environment variable (this file)
# ─────────────────────────────────────────────────────────────────────────────────

# Telegram bot token from @BotFather
# Preferred: `telclaude vault add secret telegram-bot-token`
# TELEGRAM_BOT_TOKEN=your_bot_token_here

# Anthropic API key (alternative to claude login)
# Preferred: `telclaude vault add http api.anthropic.com --type api-key --header x-api-key`
# ANTHROPIC_API_KEY=sk-ant-...

# Internal token used by agents to access the Anthropic proxy
# REQUIRED for Docker agent -> relay access (this guards /v1/anthropic-proxy)
# Generate with: openssl rand -hex 32
MOLTBOOK_PROXY_TOKEN=GENERATE_WITH_openssl_rand_-hex_32

# ─────────────────────────────────────────────────────────────────────────────────
# RPC Authentication (Ed25519 bidirectional asymmetric keys)
#
# Two keypairs per scope: agent keypair + relay keypair.
# Each side owns its own private key — compromise of one side cannot
# forge messages in the other direction.
#
# After initial auth, agents exchange for short-lived session tokens (v3).
# ─────────────────────────────────────────────────────────────────────────────────

# Telegram RPC: two keypairs for bidirectional auth
# Generate all 4 keys: telclaude keygen telegram
# Agent keypair (agent signs → relay verifies):
TELEGRAM_RPC_AGENT_PRIVATE_KEY=GENERATE_WITH_telclaude_keygen_telegram
TELEGRAM_RPC_AGENT_PUBLIC_KEY=GENERATE_WITH_telclaude_keygen_telegram
# Relay keypair (relay signs → agent verifies):
TELEGRAM_RPC_RELAY_PRIVATE_KEY=GENERATE_WITH_telclaude_keygen_telegram
TELEGRAM_RPC_RELAY_PUBLIC_KEY=GENERATE_WITH_telclaude_keygen_telegram

# Git proxy session token secret (shared between relay + agent for HMAC session tokens)
# Generate with: openssl rand -hex 32
TELCLAUDE_GIT_PROXY_SECRET=GENERATE_WITH_openssl_rand_-hex_32

# Moltbook RPC: two keypairs for bidirectional auth
# Generate all 4 keys: telclaude keygen moltbook
# Agent keypair (agent signs → relay verifies):
MOLTBOOK_RPC_AGENT_PRIVATE_KEY=GENERATE_WITH_telclaude_keygen_moltbook
MOLTBOOK_RPC_AGENT_PUBLIC_KEY=GENERATE_WITH_telclaude_keygen_moltbook
# Relay keypair (relay signs → agent verifies):
MOLTBOOK_RPC_RELAY_PRIVATE_KEY=GENERATE_WITH_telclaude_keygen_moltbook
MOLTBOOK_RPC_RELAY_PUBLIC_KEY=GENERATE_WITH_telclaude_keygen_moltbook

# ─────────────────────────────────────────────────────────────────────────────────
# Configuration Files
#
# Telclaude uses a two-file config split for Docker:
#   telclaude.json         — Policy config (providers, network, rate limits).
#                            Mounted to ALL containers (relay + agents).
#   telclaude-private.json — Relay-only overrides (allowedChats, permissions,
#                            deprecated secret fields). Mounted to relay ONLY.
#
# The relay deep-merges private on top of policy. Agents only see policy.
# This prevents secrets/PII from leaking to agent containers.
#
# For single-file setups: put everything in telclaude.json and skip the
# private file. The relay will work fine without TELCLAUDE_PRIVATE_CONFIG.
# ─────────────────────────────────────────────────────────────────────────────────

# ─────────────────────────────────────────────────────────────────────────────────
# Optional
# ─────────────────────────────────────────────────────────────────────────────────

# Log level: debug, info, warn, error
TELCLAUDE_LOG_LEVEL=info

# Network firewall (REQUIRED for Docker mode - containers run without SDK sandbox)
# Set to 1 to enable, requires --cap-add=NET_ADMIN
# SECURITY: Without firewall, Bash commands can reach arbitrary endpoints including cloud metadata
TELCLAUDE_FIREWALL=1

# Firewall DNS retry settings (internal host resolution)
# TELCLAUDE_FIREWALL_RETRY_COUNT=10
# TELCLAUDE_FIREWALL_RETRY_DELAY=2

# IPv6 fail-closed behavior
# TELCLAUDE_IPV6_FAIL_CLOSED=1

# TESTING ONLY: Bypass firewall requirement (NEVER use in production!)
# TELCLAUDE_ACCEPT_NO_FIREWALL=1

# Internal RPC allowlist for firewall (comma-separated service hostnames).
# TELCLAUDE_INTERNAL_HOSTS=telclaude,telclaude-agent

# ─────────────────────────────────────────────────────────────────────────────────
# API Keys (vault preferred — env vars as fallback)
# ─────────────────────────────────────────────────────────────────────────────────
# Preferred: Store in vault via `telclaude vault import-secrets`
# Fallback: Environment variables or `telclaude setup-openai` / `telclaude setup-git`
#
# OPENAI_API_KEY=sk-proj-...
# GITHUB_TOKEN=github_pat_...
# GH_TOKEN=...
